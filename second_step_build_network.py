import os

# Build the social network and calculate diameter and average distance
def create_popular_social_network(nodes, edges):
    # If a popualr twitter has no popular twitter friend, 
    # remove it from the network.
    degree = {}
    for e in edges:
        if e[0] in degree.keys():
            degree[e[0]] += 1
        else:
            degree[e[0]] = 1
        if e[1] in degree.keys():
            degree[e[1]] += 1
        else:
            degree[e[1]] = 1
    
    for node in nodes:
        if node not in degree.keys():
            nodes.remove(node)

    # Calculate the shortest paths with Floyd-warshall algorithm
    ids = {}
    row = [9999 for i in range(len(nodes))]
    graph = [row[:] for i in range(len(nodes))]
    for i in range(len(nodes)):
        ids[nodes[i]] = i
        graph[i][i] = 0
    for e in edges:
        graph[ids[e[0]]][ids[e[1]]] = 1
        graph[ids[e[1]]][ids[e[0]]] = 1
    for k in range(len(nodes)):
        for i in range(len(nodes)):
            for j in range(len(nodes)):
                graph[i][j] = min(graph[i][j], graph[i][k] + graph[k][j])

    # Calculate diameter and average distance
    diameter = 0
    total_distance = 0
    for i in range(len(nodes)):
        for j in range(i + 1, len(nodes)):
            total_distance += graph[i][j]
            if graph[i][j] > diameter:
                diameter = graph[i][j]

    print('Number of nodes =', len(nodes))
    print('Number of edges =', len(edges))
    print('Diameter =', diameter)
    print('Average distance =', total_distance / (len(nodes) * (len(nodes) - 1) / 2))

    return nodes, graph

if __name__ == '__main__':
    # Id of popular twitters
    nodes = ['813286', '27260086', '21447363', '79293791', '155659213', '17919972', '14230524', '15846407', '10228272', '25365536', '23375688', '26565946', '783214', '428333', '18839785', '16409683', '44409004', '15485441', '50393960', '759251', '158487331', '807095', '23083404', '85603854', '268414482', '5402612', '100220864', '19397785', '145125358', '132385468', '101311381', '105119490', '27195114', '181561712', '21111883', '11348282', '26257166', '20322929', '23151437', '31348594', '2557521', '471741741', '71201743', '116362700', '180505807', '14872237', '44196397', '84279963', '236699098', '158314798', '96951800', '135421739', '119509520', '28706024', '209708391', '19923144', '35094637', '1349149096909668363', '60865434', '169686021', '157140968', '166739404', '115485051', '176566242', '627673190', '113419517', '742143', '32959253', '1339835893', '101695592', '184910040', '90420314', '1504197044482809860', '18681139', '31927467', '25521487', '335141638', '19426551', '379408088', '23617610', '533085085', '90836187', '5988062', '17471979', '18863815', '22940219', '19895282', '1323730225067339784', '343627165', '20536157', '1652541', '558797310', '19248106', '73992972', '54829997', '23976386', '92724677', '35787166', '40255499', '183230911', '14920785', '1409798257', '219255067', '1447949844', '43152482', '224223563', '242245578', '23573083', '133880286', '20609518', '29479000', '1367531', '16303106', '405427035', '52551600', '280701704', '33884545', '85452649', '3004231', '500704345', '740336334', '35936474', '175883705', '10671602', '525264466', '19058681', '42420346', '3108351', '58531272', '14213711', '154280902', '57928790', '285332860', '151123001', '14293310', '121044171', '268439864', '24929621', '1346439824', '14502789', '50374439', '16548023', '76294950', '121046433', '213745334', '91478624', '69183155', '2893511188', '68034431', '2367911', '492399548', '405728790', '34613288', '47363197', '1492538024', '16190898', '344634424', '1465718519954214912', '230186518', '2467791', '18220175', '31239408', '1059194370', '5520952', '28785486', '17461978', '2183816041', '300392950', '112764971', '409486555', '56631494', '5536782', '87170183', '47786101', '1536791610', '24886570', '278235826', '48332360', '126571977', '62513246', '17915334', '470307418', '56783491', '250831586', '19583545', '79708561', '20015311', '155151279', '398306220', '42562446', '22910295', '27042513', '46452468', '18948541', '1349154719386775552', '148711787', '51241574', '24742040', '1115874631', '24966423', '95023423', '19725644', '3171712086', '1194575733504430081', '580097412', '136361303', '15693493', '33801019', '68497896', '366987179', '207809313', '186712788', '19028953', '18228898', '217804739', '139092348', '36152770', '140070953', '78010944', '326359913', '36483808', '23563916', '60327493', '219617448', '51376979', '43023158', '18091904', '65659343', '37034483', '474886468', '218437274', '134758540', '15439395', '21425125', '1337785291', '39364684', '44588485', '8161232', '487118986', '264107729', '265982289', '49573859', '317034396', '517077573', '30364057', '45709328', '18625669', '14159148', '185314895', '97865628', '23690344', '141664648', '68977380', '40908929', '297169759', '61507091', '2396677714', '255388236', '23561980', '216776631', '373471064', '126676337', '183387449', '23544596', '1330457336', '1636590253', '380399508', '26053643', '18222378', '128841198', '2883841', '18211861', '136007061', '57948579', '122453931', '47288005', '22324918', '18297088', '66591836', '185142711', '19562228', '17696167', '413487212', '14511951', '62557485', '366947884', '14075928', '15492359', '866953267', '14128609', '28897926', '1244602586', '254274083', '452155423', '35765232', '739784130', '140051054', '8802752', '30973', '23605048', '243711009', '212746249', '259379883', '19697415', '130104041', '16193578', '612473', '262299947', '23613479', '7517222', '59156773', '338084918', '141817380', '1964571728', '66959303', '26589987', '1329133826639990784', '215952307', '46527223', '155927976', '6480682', '46335511', '29758446', '2097571', '57261519', '5162861', '99448420', '17549677', '46247180', '382267114', '403245020', '92945681', '57998991', '36412963', '1344951', '403246803', '104249727', '425871040', '789856765', '50037051', '34743251', '44335525', '197807757', '816653', '29797128', '1307120064', '52471614', '24852465', '16129920', '57099808', '15224867', '185827887', '18588279', '266336410', '972732792055279622', '177547780', '122969292', '407054921', '321970500', '30040682', '20567939', '972651', '4101221', '74580436', '24702915', '29442313', '20545055', '1367134219361792002', '129786468', '6017542', '196795202', '6741632', '230845588', '586198217', '950165300', '53338746', '29749448', '23186079', '171682730', '180949358', '15687962', '231579149', '20432727', '885487044243238912', '87174678', '42384760', '51658431', '220228167', '1640169925', '55033131', '152251488', '519211628', '92367751', '426738834', '618420295', '803694179079458816', '28631535', '142204481', '33995409', '56304605', '117778179', '60937837', '301120393', '20346956', '74286565', '14677919', '25049177', '91390383', '344801362', '24744541', '153436029', '60576219', '134234000', '115286138', '55507370', '637313893', '87818409', '63695781', '4196983835', '259925559', '9695312', '52544275', '17813487', '288333760', '328918379', '94900238', '14824849', '17842366', '42513459', '33804533', '65992743', '158414847', '18479513', '401866664', '46769281', '520653311', '166747718', '890891', '36008570', '277434037', '95602761', '6661522', '17715048', '2156278138', '58528137', '1196254680', '443215941', '23065354', '386244525', '15648827', '265902729', '2156299840', '180463340', '37718134', '68844197', '75974281', '47459700', '17019152', '14399483', '181572333', '487736815', '245956466', '457554412', '1324334436', '6427882', '1072915220', '33933259', '462004145', '78941611', '40059553', '313913938', '19877186', '415859364', '58603510', '41043596', '330446733', '348379865', '81751472', '884378714', '262794965', '253508662', '369583954', '155705264', '508932270', '135019364', '53853197', '50826280', '573299587', '42519612', '14573900', '16228398', '35013719', '153694176', '51263592', '2203709322', '76647722', '140750163', '498840131', '16573941', '873115441303924736', '34197952', '38164846', '17093617', '104974333', '246225682', '138372303', '241382835', '14499829', '44670915', '23343960', '1575800623', '272613386', '18236230', '33868638', '14922225', '92487173', '236636515', '92708272', '7996082', '40355149', '471287735', '105297123', '14173315', '15012486', '1401587503', '21787625', '24705126', '6446742', '216447259', '141633175', '44084633', '108568373', '255030147', '355307031', '216299334', '64038747', '355708717', '15016209', '18927441', '2491702663', '110365072', '102729125', '2897441', '163559269', '14594813', '20508222', '32751684', '14631115', '59949396', '110681593', '25970331', '186386857', '11525172', '114446939', '30495613', '45865160', '254152016', '500194345', '19691643', '527526077', '47491330', '403255314', '16721910', '79650494', '96634419', '79327591', '19929890', '73443014', '169279319', '110827653', '29756339', '303862998', '230288829', '124172948', '243381107', '58233603', '468479147', '274119641', '55520719', '120178497', '34738598', '9633802', '19818494', '14353392', '154140901', '97217966', '82119937', '30631061', '139876086', '436266454', '220557145', '125603760', '30782495', '209994211', '1878450026', '619293948', '226542162', '789605024', '15872418', '1599608046', '138203134', '195703895', '950341134', '48177728', '20837438', '3063032281', '266644093', '256930894', '347035710', '101928415', '17386885', '59900378', '77888423', '145499533', '27725199', '366592246', '17020962', '50811932', '20177423', '20565284', '9317502', '310072711', '48410093', '205011496', '46602211', '170428440', '67418441', '139539038', '150566311', '26895879', '431996598', '1153045459', '275558381', '59591856', '15820664', '18676177', '16312576', '3437532637', '809500704', '137857547', '275546719', '47285504', '45278605', '30278532', '16812787', '4898091', '56505125', '1093090866', '5695632', '169274239', '128372940', '74518740', '65186457', '65184105', '432983617', '316053407', '32453930', '148507894', '29840295', '107318424', '309366491', '242101122', '153433497', '26270913', '461922813', '308297673', '16264006', '1501434991', '35982046', '305085584', '439125710', '32660559', '107120856', '34713362', '25421094', '54341363', '1299355444637511682', '913812620', '119360445', '15066760', '14780915', '15670515', '131574396', '50004938', '18825961', '95955871', '28638191', '17929027', '9604032', '65151248', '50648847', '55616342', '43394391', '846369751', '4970411', '202890266', '427475002', '204832963', '58598187', '352145373', '55043362', '15809249', '36947388', '66561957', '17336417', '168767461', '20479813', '268361752', '52422878', '44627459', '6253282', '15016249', '251600033', '38741679', '34949757', '312230865', '84554399', '378632690', '7587032', '51742969', '19373710', '51509917', '54951973', '1451338682674434052', '230377004', '18208354', '4628602041', '115341081', '38679388', '120990817', '214942749', '66083959', '18713254', '1429480158', '63701775', '262881419', '834702151', '408177579', '111871312', '109275593', '128155589', '14222536', '75916180', '40527958', '238475531', '16913418', '19329393', '41626669', '181567076', '970207298', '138814032', '247653244', '19609162', '32765534', '16542390', '550202880', '14727959', '252153070', '15460081', '500042487', '96879107', '28412286', '160308387', '214201922', '14224719', '1176135546', '96123433', '144376833', '98310564', '2233154425', '385291247', '38185503', '214570761', '10810102', '213969309', '63796949', '1264208004', '39453212', '84620024', '361315016', '42916821', '41384170', '134657984', '3065261233', '15234657', '96083073', '1652526218', '43003845', '124839730', '21254264', '131948686', '19018401', '14800270', '15290441', '17284624', '410409666', '16676396', '183078358', '31685653', '142519598', '2921763658', '386420143', '65647594', '216430965', '304596944', '16589206', '311940255', '2729506932', '106345557', '31080039', '64839766', '512613427', '103821088', '453507741', '16331010', '1117786405', '103550181', '21366823', '1257746276944248832', '21931363', '156132825', '393852070', '17169320', '113278275', '104288093', '117407834', '179530581', '828742454', '769727912', '17790274', '182317200', '38403110', '15057943', '31547933', '125225621', '42434332', '939091', '711694309', '160926944', '35693211', '24963961', '205302299', '137017726', '19230601', '27909036', '24741517', '6519522', '83297130', '43132532', '316389142', '3129056526', '216444984', '85772748', '21586418', '16827333', '92670884', '15095537', '238319766', '37972440', '130834357', '14834302', '13298072', '152902472', '214017108', '220332457', '115622213', '130122646', '141052723', '319981198', '1976143068', '342562305', '77694285', '18936161', '22461427', '72064417', '17753033', '154605679', '92726549', '40076725', '2459371', '46832898', '29547045', '24900072']

    # Load popular twitters and their popular twitter friends
    current_path = os.path.dirname(__file__)
    file_name = current_path + '/data/popular_twitter_friends.txt'
    f = open(file_name, 'r')
    edges = []
    for line in f.readlines():
        elements = line.rstrip('\n').split(' ')
        elements.remove(':')
        if elements[-1] == '':
            elements.pop(-1)
        for i in range(1, len(elements)):
            edges.append((elements[0], elements[i]))
    f.close()
    
    # Build the social network and calculate diameter and average distance
    nodes, graph = create_popular_social_network(nodes, edges)

    # Output the result
    # popular_network_nodes.txt stores the id of these popular twitters
    popular_network_nodes_file = current_path + '/data/popular_network_nodes.txt'
    f = open(popular_network_nodes_file, 'w')
    for node in nodes:
        f.write(node + ' ')
    f.close()

    # popular_network_shortest_distance_matrix.txt stores their shortest distance
    popular_network_matrix_file = current_path + '/data/popular_network_shortest_distance_matrix.txt'
    f = open(popular_network_matrix_file, 'w')
    for row in graph:
        for element in row:
            f.write(str(element) + ' ')
        f.write('\n')
    f.close()

